<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Kaleido scope</title>
<link rel="stylesheet" type="text/css" href="styles.css">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
  <script src="https://skyway.io/dist/0.3/peer.js"></script>

  <script>
  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

  var myStream;
  var peer = new Peer({key: '23146651-8c57-4230-abd6-367799f6e270'});

  var setOthersStream = function(stream){
    $('#others-video').prop('src', URL.createObjectURL(stream));
  };

  var setMyStream = function(stream){
    myStream = stream;
    $('#video').prop('src', URL.createObjectURL(stream));
    $('#video1').prop('src', URL.createObjectURL(stream));
    $('#video2').prop('src', URL.createObjectURL(stream));
    $('#video3').prop('src', URL.createObjectURL(stream));
    $('#video4').prop('src', URL.createObjectURL(stream));
    $('#video5').prop('src', URL.createObjectURL(stream));
    $('#video6').prop('src', URL.createObjectURL(stream));
    $('#video7').prop('src', URL.createObjectURL(stream));
    $('#video8').prop('src', URL.createObjectURL(stream));
    $('#video9').prop('src', URL.createObjectURL(stream));
    $('#video10').prop('src', URL.createObjectURL(stream));
    $('#video11').prop('src', URL.createObjectURL(stream));
    $('#video12').prop('src', URL.createObjectURL(stream));
    $('#video13').prop('src', URL.createObjectURL(stream));
    $('#video14').prop('src', URL.createObjectURL(stream));
    $('#video15').prop('src', URL.createObjectURL(stream));
    $('#video16').prop('src', URL.createObjectURL(stream));
    $('#video17').prop('src', URL.createObjectURL(stream));
    $('#video18').prop('src', URL.createObjectURL(stream));
    $('#video19').prop('src', URL.createObjectURL(stream));
  };

  peer.on('open', function(id){
    $('#peer-id').text(id);
  });

  peer.on('call', function(call){
    call.answer(myStream);
    call.on('stream', setOthersStream);
  });

  $(function(){
    navigator.getUserMedia({audio: true, video: true}, setMyStream, function(){});

    $('#call').on('click', function(){
      var call = peer.call($('#others-peer-id').val(), myStream);
      call.on('stream', setOthersStream);
    });
  });

  peer.on('error', function(e){
    console.log(e.message);
  });
  </script>
</head>

<body>
  <p>あなたのID : <span id="peer-id"></span></p>
  <div id="dial">
    <input type="text" id="others-peer-id" placeholder="相手のIDを入力" /><button id="call">コール</button>
  </div>
<center>
  <video id="video" autoplay muted></video>
  <video id="video1" autoplay muted></video>
  <video id="video2" autoplay muted></video>
  <video id="video3" autoplay muted></video>
  <video id="video4" autoplay muted></video>
  <video id="video5" autoplay muted></video>
  <video id="video6" autoplay muted></video>
  <video id="video7" autoplay muted></video>
  <video id="video8" autoplay muted></video>
  <video id="video9" autoplay muted></video>
  <video id="video10" autoplay muted></video>
  <video id="video11" autoplay muted></video>
  <video id="video12" autoplay muted></video>
  <video id="video13" autoplay muted></video>
  <video id="video14" autoplay muted></video>
  <video id="video15" autoplay muted></video>
  <video id="video16" autoplay muted></video>
  <video id="video17" autoplay muted></video>
  <video id="video18" autoplay muted></video>
  <video id="video19" autoplay muted></video>
  <br>
  <video id="others-video" autoplay width="100%"></video>
</center>

</body>
</html>
